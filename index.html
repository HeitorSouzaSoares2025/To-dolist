<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do List</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --accent: #3b82f6; /* Azul elegante */
  --accent2: #22c55e; /* Verde suave */
}
body {
  background: #f5f5f5;
  color: #222;
  transition: background 0.3s, color 0.3s;
}
body.dark {
  background: #1e1e2f;
  color: #eaeaea;
}
.task-card.dragging { opacity: .5 }
.calendar input[type="date"] {
  background: transparent;
  border: 1px solid var(--accent);
  padding: 4px;
  border-radius: 4px;
}
.neon-border {
  border: 2px solid var(--accent);
  box-shadow: 0 0 8px var(--accent);
  transition: all .3s;
}
body.dark .neon-border {
  border-color: var(--accent2);
  box-shadow: 0 0 8px var(--accent2);
}
.priority-high { border-left: 4px solid var(--accent); }
.priority-medium { border-left: 4px solid var(--accent2); }
.priority-low { border-left: 4px solid #777; }
.important {
  border: 2px solid gold;
  box-shadow: 0 0 8px gold;
}
</style>
</head>
<body class="min-h-screen flex flex-col items-center">

<!-- LOGIN -->
<div id="loginSection" class="w-full max-w-sm p-4 mt-8 neon-border rounded-lg">
  <h1 class="text-2xl mb-4 text-center font-bold text-blue-500 dark:text-green-400">Login</h1>
  <input id="usernameInput" type="text" placeholder="Digite seu usuário"
    class="w-full p-2 mb-4 rounded bg-white dark:bg-[#2a2a3d] border border-blue-400 dark:border-green-400 text-black dark:text-white">
  <button id="loginBtn"
    class="w-full bg-blue-500 hover:bg-blue-400 dark:bg-green-500 dark:hover:bg-green-400 text-white font-semibold py-2 rounded">Entrar</button>
</div>

<!-- APP -->
<div id="appSection" class="hidden w-full max-w-2xl p-4">
  <header class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold text-blue-500 dark:text-green-400">To-Do List</h1>
    <div class="flex gap-2">
      <button id="toggleDarkMode" class="px-3 py-1 rounded bg-blue-500 text-white hover:bg-blue-400 dark:bg-green-500 dark:hover:bg-green-400">Dark/Light</button>
      <button id="logoutBtn" class="px-3 py-1 rounded bg-red-500 text-white hover:bg-red-400">Sair</button>
    </div>
  </header>

  <form id="taskForm" class="flex flex-col gap-3 mb-6 p-4 rounded-lg neon-border">
    <input id="taskInput" type="text" placeholder="Nova tarefa"
      class="p-2 rounded bg-white dark:bg-[#2a2a3d] border border-blue-400 dark:border-green-400 text-black dark:text-white">
    <select id="priorityInput"
      class="p-2 rounded bg-white dark:bg-[#2a2a3d] border border-blue-400 dark:border-green-400 text-black dark:text-white">
      <option value="low">Baixa</option>
      <option value="medium">Média</option>
      <option value="high">Alta</option>
    </select>
    <div class="calendar">
      <input id="dueDateInput" type="date" class="w-full">
    </div>
    <button class="bg-blue-500 hover:bg-blue-400 dark:bg-green-500 dark:hover:bg-green-400 text-white font-semibold py-2 rounded">Adicionar</button>
  </form>

  <div class="flex justify-between items-center mb-4">
    <input id="searchInput" type="text" placeholder="Buscar tarefas"
      class="p-2 rounded bg-white dark:bg-[#2a2a3d] border border-blue-400 dark:border-green-400 text-black dark:text-white w-1/2">
    <select id="filterSelect"
      class="p-2 rounded bg-white dark:bg-[#2a2a3d] border border-blue-400 dark:border-green-400 text-black dark:text-white">
      <option value="all">Todas</option>
      <option value="pending">Pendentes</option>
      <option value="completed">Concluídas</option>
    </select>
  </div>

  <ul id="taskList" class="flex flex-col gap-3"></ul>
</div>

<script>
const loginSection=document.getElementById('loginSection')
const appSection=document.getElementById('appSection')
const usernameInput=document.getElementById('usernameInput')
const loginBtn=document.getElementById('loginBtn')
const logoutBtn=document.getElementById('logoutBtn')
const toggleDarkMode=document.getElementById('toggleDarkMode')
const taskForm=document.getElementById('taskForm')
const taskInput=document.getElementById('taskInput')
const priorityInput=document.getElementById('priorityInput')
const dueDateInput=document.getElementById('dueDateInput')
const taskList=document.getElementById('taskList')
const searchInput=document.getElementById('searchInput')
const filterSelect=document.getElementById('filterSelect')

let currentUser=null
let tasks=[]

function saveTasks(){localStorage.setItem(`tasks_${currentUser}`,JSON.stringify(tasks))}
function loadTasks(){tasks=JSON.parse(localStorage.getItem(`tasks_${currentUser}`)||'[]')}
function renderTasks(){
  taskList.innerHTML=''
  const search=searchInput.value.toLowerCase()
  const filter=filterSelect.value
  const sorted=[...tasks].sort((a,b)=>b.important-a.important)
  sorted.forEach((t,i)=>{
    if(t.title.toLowerCase().includes(search) && (filter==='all'||(filter==='pending'&&!t.completed)||(filter==='completed'&&t.completed))){
      const li=document.createElement('li')
      li.draggable=true
      li.dataset.index=i
      li.className=`task-card p-3 rounded bg-white dark:bg-[#2a2a3d] neon-border ${t.priority==='high'?'priority-high':t.priority==='medium'?'priority-medium':'priority-low'} ${t.important?'important':''}`
      li.innerHTML=`
        <div class="flex justify-between items-center">
          <div>
            <input type="checkbox" class="mr-2" ${t.completed?'checked':''}>
            <span class="${t.completed?'line-through text-gray-500':''}">${t.title}</span>
            ${t.dueDate?`<small class="ml-2 text-blue-500 dark:text-green-400">[${t.dueDate}]</small>`:''}
          </div>
          <div class="flex gap-2">
            <button class="toggle-important ${t.important?'text-yellow-400':'text-gray-400'}">⭐</button>
            <button class="add-subtask text-blue-500 dark:text-green-400">＋</button>
            <button class="delete-task text-red-500">✕</button>
          </div>
        </div>
        <ul class="subtasks mt-2 pl-6"></ul>`
      const subtasksUl=li.querySelector('.subtasks')
      t.subtasks.forEach((s,si)=>{
        const sLi=document.createElement('li')
        sLi.innerHTML=`<input type="checkbox" class="mr-2" ${s.done?'checked':''}> <span class="${s.done?'line-through text-gray-500':''}">${s.text}</span>`
        subtasksUl.appendChild(sLi)
        sLi.querySelector('input').addEventListener('change',()=>{s.done=!s.done;saveTasks();renderTasks()})
      })
      li.querySelector('input[type="checkbox"]').addEventListener('change',()=>{t.completed=!t.completed;saveTasks();renderTasks()})
      li.querySelector('.delete-task').addEventListener('click',()=>{tasks.splice(i,1);saveTasks();renderTasks()})
      li.querySelector('.add-subtask').addEventListener('click',()=>{
        const txt=prompt('Digite a subtarefa:')
        if(txt){t.subtasks.push({text:txt,done:false});saveTasks();renderTasks()}
      })
      li.querySelector('.toggle-important').addEventListener('click',()=>{t.important=!t.important;saveTasks();renderTasks()})
      taskList.appendChild(li)
    }
  })
  enableDragDrop()
}

function enableDragDrop(){
  const items=document.querySelectorAll('#taskList .task-card')
  items.forEach(it=>{
    it.addEventListener('dragstart',()=>it.classList.add('dragging'))
    it.addEventListener('dragend',()=>{it.classList.remove('dragging');reorderTasks()})
  })
  taskList.addEventListener('dragover',e=>{
    e.preventDefault()
    const dragging=document.querySelector('.dragging')
    const siblings=[...taskList.querySelectorAll('.task-card:not(.dragging)')]
    const next=siblings.find(s=>e.clientY<=s.offsetTop+s.offsetHeight/2)
    taskList.insertBefore(dragging,next)
  })
}

function reorderTasks(){
  const newOrder=[...taskList.querySelectorAll('.task-card')].map(it=>tasks[it.dataset.index])
  tasks=newOrder
  saveTasks()
  renderTasks()
}

taskForm.addEventListener('submit',e=>{
  e.preventDefault()
  const title=taskInput.value.trim()
  if(title){
    tasks.push({title,completed:false,priority:priorityInput.value,dueDate:dueDateInput.value,subtasks:[],important:false})
    saveTasks()
    renderTasks()
    taskForm.reset()
  }
})

searchInput.addEventListener('input',renderTasks)
filterSelect.addEventListener('change',renderTasks)
toggleDarkMode.addEventListener('click',()=>document.body.classList.toggle('dark'))

loginBtn.addEventListener('click',()=>{
  const u=usernameInput.value.trim()
  if(u){
    currentUser=u
    loginSection.classList.add('hidden')
    appSection.classList.remove('hidden')
    loadTasks()
    renderTasks()
  }
})

logoutBtn.addEventListener('click',()=>{
  currentUser=null
  tasks=[]
  appSection.classList.add('hidden')
  loginSection.classList.remove('hidden')
})

function checkDueDates(){
  const today=new Date().toISOString().split('T')[0]
  tasks.forEach(t=>{
    if(t.dueDate===today&&!t.completed){
      new Notification('Tarefa pendente',{body:t.title})
    }
  })
}
if('Notification'in window&&Notification.permission!=='granted'){Notification.requestPermission()}
setInterval(checkDueDates,60000)
</script>
</body>
</html>
