<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do List</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --main-bg: #ffffff;
  --main-text: #000000;
  --accent: #2563eb;      /* Azul Tailwind */
  --border: #d1d5db;
}
body.dark {
  --main-bg: #121212;
  --main-text: #f0f0f0;
  --accent: #3b82f6;
  --border: #374151;
}
body {
  background: var(--main-bg);
  color: var(--main-text);
  transition: background .3s, color .3s;
}
.task-card {
  background: var(--main-bg);
  border: 1px solid var(--border);
  padding: .75rem;
  border-radius: .5rem;
  transition: background .3s, border .3s;
}
.task-card.dragging { opacity: .5; }
.priority-high { border-left: 4px solid #ef4444; }
.priority-medium { border-left: 4px solid #f59e0b; }
.priority-low { border-left: 4px solid #10b981; }
.important { border: 2px solid #eab308; }
.calendar input[type="date"] {
  background: var(--main-bg);
  color: var(--main-text);
  border: 1px solid var(--border);
  border-radius: .25rem;
  padding: .25rem .5rem;
}
input, select {
  background: var(--main-bg);
  color: var(--main-text);
  border: 1px solid var(--border);
}
button {
  transition: background .3s;
}
</style>
</head>
<body class="min-h-screen flex flex-col items-center">

<div id="loginSection" class="w-full max-w-sm p-4 mt-8 border rounded-lg">
  <h1 class="text-2xl mb-4 text-center font-bold">Login</h1>
  <input id="usernameInput" type="text" placeholder="Digite seu usuário"
         class="w-full p-2 mb-4 rounded border">
  <button id="loginBtn"
          class="w-full bg-blue-600 text-white font-semibold py-2 rounded hover:bg-blue-500">
    Entrar
  </button>
</div>

<div id="appSection" class="hidden w-full max-w-2xl p-4">
  <header class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">To-Do List</h1>
    <div class="flex gap-2">
      <button id="toggleDarkMode"
              class="px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-500">
        Mudar Tema
      </button>
      <button id="logoutBtn"
              class="px-3 py-1 rounded bg-red-600 text-white hover:bg-red-500">
        Sair
      </button>
    </div>
  </header>

  <form id="taskForm" class="flex flex-col gap-3 mb-6 p-4 rounded-lg border">
    <input id="taskInput" type="text" placeholder="Nova tarefa" class="p-2 rounded border">
    <select id="priorityInput" class="p-2 rounded border">
      <option value="low">Baixa</option>
      <option value="medium">Média</option>
      <option value="high">Alta</option>
    </select>
    <div class="calendar">
      <input id="dueDateInput" type="date">
    </div>
    <button class="bg-blue-600 text-white font-semibold py-2 rounded hover:bg-blue-500">
      Adicionar
    </button>
  </form>

  <div class="flex justify-between items-center mb-4">
    <input id="searchInput" type="text" placeholder="Buscar tarefas"
           class="p-2 rounded border w-1/2">
    <select id="filterSelect" class="p-2 rounded border">
      <option value="all">Todas</option>
      <option value="pending">Pendentes</option>
      <option value="completed">Concluídas</option>
    </select>
  </div>

  <ul id="taskList" class="flex flex-col gap-3"></ul>
</div>

<script>
const loginSection=document.getElementById('loginSection')
const appSection=document.getElementById('appSection')
const usernameInput=document.getElementById('usernameInput')
const loginBtn=document.getElementById('loginBtn')
const logoutBtn=document.getElementById('logoutBtn')
const toggleDarkMode=document.getElementById('toggleDarkMode')
const taskForm=document.getElementById('taskForm')
const taskInput=document.getElementById('taskInput')
const priorityInput=document.getElementById('priorityInput')
const dueDateInput=document.getElementById('dueDateInput')
const taskList=document.getElementById('taskList')
const searchInput=document.getElementById('searchInput')
const filterSelect=document.getElementById('filterSelect')

let currentUser=null
let tasks=[]

function saveTasks(){localStorage.setItem(`tasks_${currentUser}`,JSON.stringify(tasks))}
function loadTasks(){tasks=JSON.parse(localStorage.getItem(`tasks_${currentUser}`)||'[]')}
function renderTasks(){
 taskList.innerHTML=''
 const search=searchInput.value.toLowerCase()
 const filter=filterSelect.value
 const sortedTasks=[...tasks].sort((a,b)=>b.important-a.important)
 sortedTasks.forEach((t,i)=>{
  if(t.title.toLowerCase().includes(search)&&(filter==='all'||(filter==='pending'&&!t.completed)||(filter==='completed'&&t.completed))){
    const li=document.createElement('li')
    li.draggable=true
    li.dataset.index=i
    li.className=`task-card ${t.priority==='high'?'priority-high':t.priority==='medium'?'priority-medium':'priority-low'} ${t.important?'important':''}`
    li.innerHTML=`
      <div class="flex justify-between items-center">
        <div>
          <input type="checkbox" class="mr-2" ${t.completed?'checked':''}>
          <span class="${t.completed?'line-through text-gray-500':''}">${t.title}</span>
          ${t.dueDate?`<small class="ml-2 text-blue-500">[${t.dueDate}]</small>`:''}
        </div>
        <div class="flex gap-2">
          <button class="toggle-important ${t.important?'text-yellow-500':'text-gray-400'}">⭐</button>
          <button class="add-subtask text-blue-500">＋</button>
          <button class="delete-task text-red-500">✕</button>
        </div>
      </div>
      <ul class="subtasks mt-2 pl-6"></ul>`
    const subtasksUl=li.querySelector('.subtasks')
    t.subtasks.forEach((s,si)=>{
      const sLi=document.createElement('li')
      sLi.innerHTML=`<input type="checkbox" class="mr-2" ${s.done?'checked':''}>
                     <span class="${s.done?'line-through text-gray-500':''}">${s.text}</span>`
      subtasksUl.appendChild(sLi)
      sLi.querySelector('input').addEventListener('change',()=>{
        s.done=!s.done
        saveTasks();renderTasks()
      })
    })
    li.querySelector('input[type="checkbox"]').addEventListener('change',()=>{
      t.completed=!t.completed
      saveTasks();renderTasks()
    })
    li.querySelector('.delete-task').addEventListener('click',()=>{
      tasks.splice(tasks.indexOf(t),1)
      saveTasks();renderTasks()
    })
    li.querySelector('.add-subtask').addEventListener('click',()=>{
      const txt=prompt('Digite a subtarefa:')
      if(txt){t.subtasks.push({text:txt,done:false});saveTasks();renderTasks()}
    })
    li.querySelector('.toggle-important').addEventListener('click',()=>{
      t.important=!t.important
      saveTasks();renderTasks()
    })
    taskList.appendChild(li)
  }
 })
 enableDragDrop()
}

function enableDragDrop(){
 const items=document.querySelectorAll('#taskList .task-card')
 items.forEach(it=>{
  it.addEventListener('dragstart',()=>it.classList.add('dragging'))
  it.addEventListener('dragend',()=>{it.classList.remove('dragging');reorderTasks()})
 })
 taskList.addEventListener('dragover',e=>{
  e.preventDefault()
  const dragging=document.querySelector('.dragging')
  const siblings=[...taskList.querySelectorAll('.task-card:not(.dragging)')]
  const next=siblings.find(s=>e.clientY<=s.offsetTop+s.offsetHeight/2)
  taskList.insertBefore(dragging,next)
 })
}
function reorderTasks(){
 tasks=[...taskList.querySelectorAll('.task-card')].map(it=>tasks[it.dataset.index])
 saveTasks();renderTasks()
}

taskForm.addEventListener('submit',e=>{
 e.preventDefault()
 const title=taskInput.value.trim()
 if(title){
  tasks.push({title,completed:false,priority:priorityInput.value,dueDate:dueDateInput.value,subtasks:[],important:false})
  saveTasks();renderTasks();taskForm.reset()
 }
})
searchInput.addEventListener('input',renderTasks)
filterSelect.addEventListener('change',renderTasks)

toggleDarkMode.addEventListener('click',()=>document.body.classList.toggle('dark'))

loginBtn.addEventListener('click',()=>{
 const u=usernameInput.value.trim()
 if(u){
  currentUser=u
  loginSection.classList.add('hidden')
  appSection.classList.remove('hidden')
  loadTasks();renderTasks()
 }
})
logoutBtn.addEventListener('click',()=>{
 currentUser=null;tasks=[]
 appSection.classList.add('hidden')
 loginSection.classList.remove('hidden')
})

function checkDueDates(){
 const today=new Date().toISOString().split('T')[0]
 tasks.forEach(t=>{
  if(t.dueDate===today&&!t.completed){
   new Notification('Tarefa pendente',{body:t.title})
  }
 })
}
if('Notification'in window&&Notification.permission!=='granted'){Notification.requestPermission()}
setInterval(checkDueDates,60000)
</script>
</body>
</html>
