<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do List Profissional Avançada</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background:#f4f4f4; display:flex; justify-content:center; padding:20px; }
.container { background:#fff; padding:20px; border-radius:10px; width:100%; max-width:700px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
h1 { text-align:center; margin-bottom:20px; color:#333; }
form { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
form input, form select { flex:1; padding:10px; border-radius:5px; border:1px solid #ccc; }
form input[type="datetime-local"], form input[type="number"] { flex:1 0 150px; }
form button { padding:10px 15px; border:none; background:#28a745; color:#fff; border-radius:5px; cursor:pointer; transition:0.3s; }
form button:hover { background:#218838; }
.filters { display:flex; gap:10px; margin-bottom:15px; }
.filters select { flex:1; padding:8px; border-radius:5px; border:1px solid #ccc; }
ul#task-list { list-style:none; }
ul#task-list li { display:flex; flex-direction:column; padding:10px; margin-bottom:8px; border-radius:5px; transition:0.3s; cursor:pointer; border-left:5px solid transparent; position:relative; }
li.completed span { text-decoration:line-through; color:#888; }
li .task-info { display:flex; justify-content:space-between; align-items:center; }
li .task-actions { margin-top:5px; }
li .task-actions button { margin-left:5px; border:none; border-radius:5px; cursor:pointer; padding:5px 8px; transition:0.3s; }
li .task-actions button.edit { background:#ffc107; color:#fff; }
li .task-actions button.delete { background:#dc3545; color:#fff; }
li .task-actions button:hover { opacity:0.8; }
.task-bar { height:5px; border-radius:3px; margin-top:5px; }
#task-count { margin-top:15px; text-align:center; font-weight:bold; }
.export-import { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap; }
.export-import button, .export-import input { flex:1; padding:8px; border-radius:5px; border:1px solid #ccc; cursor:pointer; }
@media(max-width:700px){ form { flex-direction:column; } .filters { flex-direction:column; } .export-import { flex-direction:column; } }
</style>
</head>
<body>
<div class="container">
<h1>To-Do List Profissional Avançada</h1>

<form id="task-form">
<input type="text" id="task-input" placeholder="Digite sua tarefa..." required>
<input type="datetime-local" id="task-deadline" required>
<input type="number" id="task-alert" placeholder="Alertar X min antes" min="0" value="0">
<select id="category-select">
<option value="Pessoal">Pessoal</option>
<option value="Trabalho">Trabalho</option>
<option value="Estudo">Estudo</option>
</select>
<select id="priority-select">
<option value="Baixa">Baixa</option>
<option value="Média">Média</option>
<option value="Alta">Alta</option>
</select>
<button type="submit">Adicionar</button>
</form>

<div class="filters">
<select id="filter-status">
<option value="all">Todas</option>
<option value="pending">Pendentes</option>
<option value="completed">Concluídas</option>
</select>
<select id="filter-category">
<option value="all">Todas categorias</option>
<option value="Pessoal">Pessoal</option>
<option value="Trabalho">Trabalho</option>
<option value="Estudo">Estudo</option>
</select>
</div>

<div class="export-import">
<button id="export-csv">Exportar CSV</button>
<button id="export-pdf">Exportar PDF</button>
<input type="file" id="import-csv" accept=".csv">
</div>

<ul id="task-list"></ul>
<div id="task-count">Tarefas pendentes: 0</div>
<audio id="alarm-sound" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3" preload="auto"></audio>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const taskForm=document.getElementById('task-form');
const taskInput=document.getElementById('task-input');
const taskDeadline=document.getElementById('task-deadline');
const taskAlert=document.getElementById('task-alert');
const categorySelect=document.getElementById('category-select');
const prioritySelect=document.getElementById('priority-select');
const taskList=document.getElementById('task-list');
const taskCount=document.getElementById('task-count');
const filterStatus=document.getElementById('filter-status');
const filterCategory=document.getElementById('filter-category');
const alarmSound=document.getElementById('alarm-sound');

const exportCsvBtn=document.getElementById('export-csv');
const exportPdfBtn=document.getElementById('export-pdf');
const importCsvInput=document.getElementById('import-csv');

let tasks=JSON.parse(localStorage.getItem('tasks'))||[];
if("Notification" in window){ Notification.requestPermission(); }

function saveTasks(){ localStorage.setItem('tasks',JSON.stringify(tasks)); }
function updateCount(){ taskCount.textContent=`Tarefas pendentes: ${tasks.filter(t=>!t.completed).length}`; }
function notify(task,msg){ if(Notification.permission==="granted"){ new Notification(msg,{ body:`[${task.category}] ${task.text} (${task.priority}) - Prazo: ${task.deadline}` }); } alarmSound.play(); }

function checkDeadlines(){
    const now=new Date();
    tasks.forEach(task=>{
        if(task.completed) return;
        const deadline=new Date(task.deadline);
        const alertTime=new Date(deadline.getTime()-(task.alert*60000||0));
        if(!task.alerted && task.alert>0 && now>=alertTime && now<deadline){ notify(task,"Alerta antecipado!"); task.alerted=true; }
        if(!task.notified && now>=deadline){ notify(task,"Tarefa vencida!"); task.notified=true; }
    });
    saveTasks(); renderTasks();
}
setInterval(checkDeadlines,60000);

function createTaskElement(task,index){
    const li=document.createElement('li');
    li.className=`priority-${task.priority}`;
    if(task.completed) li.classList.add('completed');

    const now=new Date();
    const deadline=new Date(task.deadline);
    const diffMs = deadline - now;
    const totalMs = deadline - new Date(task.created||now);
    const percent = totalMs>0 ? Math.max(0,Math.min(100,(diffMs/totalMs)*100)) : 0;

    // Gradiente de urgência
    if(!task.completed){
        if(diffMs <= 0){
            li.style.borderLeftColor="#dc3545";
        } else if(diffMs <= 24*3600000){
            const ratio = diffMs/(24*3600000);
            const r = Math.round(255*(1-ratio));
            const g = Math.round(193*ratio);
            const b = 7;
            li.style.borderLeftColor=`rgb(${r},${g},${b})`;
        } else {
            li.style.borderLeftColor="#28a745";
        }
    }

    // Tooltip
    let tooltipText="";
    if(task.completed){
        tooltipText="Tarefa concluída";
    } else if(diffMs<=0){
        tooltipText="Vencida!";
    } else {
        const hours=Math.floor(diffMs/3600000);
        const minutes=Math.floor((diffMs%3600000)/60000);
        tooltipText=`Tempo restante: ${hours}h ${minutes}m`;
    }
    li.title = tooltipText;

    // Barra de tempo restante
    const bar=document.createElement('div');
    bar.className="task-bar";
    if(task.priority==="Baixa") bar.style.background="#87CEFA";
    else if(task.priority==="Média") bar.style.background="#FFD700";
    else bar.style.background="#FF6347";
    bar.style.width=percent+"%";
    li.appendChild(bar);

    li.setAttribute('draggable',true);
    li.innerHTML=`<div class="task-info">[${task.category}] ${task.text} (${task.priority}) - Prazo: ${task.deadline.replace("T"," ")} - Alertar: ${task.alert} min antes</div>
    <div class="task-actions">
    <button class="edit">Editar</button>
    <button class="delete">Excluir</button>
    </div>`;
    li.appendChild(bar);

    li.querySelector('.task-info').addEventListener('click',()=>{ task.completed=!task.completed; saveTasks(); renderTasks(); });
    li.querySelector('.edit').addEventListener('click',()=>{
        const newText=prompt("Editar tarefa:",task.text);
        const newDeadline=prompt("Editar prazo (AAAA-MM-DDTHH:MM):",task.deadline);
        const newAlert=prompt("Alertar X minutos antes:",task.alert);
        if(newText && newDeadline){ task.text=newText; task.deadline=newDeadline; task.alert=parseInt(newAlert)||0; task.notified=false; task.alerted=false; saveTasks(); renderTasks(); }
    });
    li.querySelector('.delete').addEventListener('click',()=>{
        if(confirm("Deseja realmente excluir esta tarefa?")){ tasks.splice(index,1); saveTasks(); renderTasks(); }
    });
    li.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain',index); });
    li.addEventListener('dragover',e=>e.preventDefault());
    li.addEventListener('drop',e=>{
        e.preventDefault();
        const draggedIndex=e.dataTransfer.getData('text/plain');
        const temp=tasks[draggedIndex];
        tasks.splice(draggedIndex,1);
        tasks.splice(index,0,temp);
        saveTasks(); renderTasks();
    });

    return li;
}

function renderTasks(){
    taskList.innerHTML='';
    let filtered=tasks;
    if(filterStatus.value!=='all'){ const completed=filterStatus.value==='completed'; filtered=filtered.filter(t=>t.completed===completed);}
    if(filterCategory.value!=='all'){ filtered=filtered.filter(t=>t.category===filterCategory.value);}
    filtered.forEach((task,index)=>taskList.appendChild(createTaskElement(task,index)));
    updateCount();
}

taskForm.addEventListener('submit',e=>{
    e.preventDefault();
    if(!taskInput.value || !taskDeadline.value) return;
    const now=new Date();
    const newTask={ text:taskInput.value, deadline:taskDeadline.value, alert:parseInt(taskAlert.value)||0, category:categorySelect.value, priority:prioritySelect.value, completed:false, notified:false, alerted:false, created:now };
    tasks.push(newTask); saveTasks(); taskInput.value=''; taskDeadline.value=''; taskAlert.value='0'; renderTasks();
});

filterStatus.addEventListener('change',renderTasks);
filterCategory.addEventListener('change',renderTasks);

exportCsvBtn.addEventListener('click',()=>{
    const csvContent="data:text/csv;charset=utf-8,"+["Tarefa,Prazo,Alertar,Categoria,Prioridade,Concluída"].concat(tasks.map(t=>`${t.text},${t.deadline},${t.alert},${t.category},${t.priority},${t.completed}`)).join("\n");
    const encodedUri=encodeURI(csvContent);
    const link=document.createElement("a"); link.setAttribute("href",encodedUri); link.setAttribute("download","tasks.csv"); document.body.appendChild(link); link.click(); document.body.removeChild(link);
});

exportPdfBtn.addEventListener('click',()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(12); let y=10;
    doc.text("To-Do List",10,y); y+=10;
    tasks.forEach(t=>{
        let line=`- [${t.category}] ${t.text} (${t.priority}) - Prazo: ${t.deadline} - Alertar: ${t.alert} min antes - Concluída: ${t.completed}`;
        if(y>280){ doc.addPage(); y=10; }
        doc.text(line,10,y); y+=8;
    });
    doc.save("tasks.pdf");
});

importCsvInput.addEventListener('change',e=>{
    const file=e.target.files[0];
    if(file){
        const reader=new FileReader();
        reader.onload=function(event){
            const lines=event.target.result.split("\n").slice(1);
            lines.forEach(line=>{
                const [text,deadline,alert,category,priority,completed]=line.split(",");
                if(text && deadline) tasks.push({text,deadline,alert:parseInt(alert)||0,category,priority,completed:completed==="true",notified:false,alerted:false,created:new Date()});
            });
            saveTasks(); renderTasks();
        };
        reader.readAsText(file);
    }
});

renderTasks();
</script>
</body>
</html>
