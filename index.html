<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonte Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    * { font-family: 'Poppins', sans-serif; }

    /* Animações personalizadas */
    .fade-in { animation: fade-in 0.4s ease-in-out; }
    @keyframes fade-in { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

    .toast-show { animation: slide-in 0.4s ease; }
    @keyframes slide-in { from {opacity:0; transform: translateX(100%);} to {opacity:1; transform: translateX(0);} }

    .backdrop { background: rgba(0,0,0,0.5); }
  </style>
</head>
<body class="bg-gradient-to-r from-slate-100 to-slate-200 dark:from-gray-900 dark:to-gray-800 min-h-screen flex justify-center p-6 transition-colors">

  <!-- CONTAINER -->
  <div class="w-full max-w-2xl bg-white dark:bg-gray-900 rounded-xl shadow-xl p-6 space-y-4">

    <h1 class="text-3xl font-bold text-center text-indigo-600 dark:text-indigo-400">Task Manager</h1>

    <!-- CONTROLS -->
    <div class="flex flex-wrap gap-3">
      <input id="taskInput" type="text" placeholder="Nova tarefa" class="flex-1 px-3 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:border-gray-700 dark:text-white" />
      <input id="taskDate" type="date" class="px-3 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:border-gray-700 dark:text-white" />
      <select id="taskPriority" class="px-3 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:border-gray-700 dark:text-white">
        <option value="low">Baixa</option>
        <option value="medium">Média</option>
        <option value="high">Alta</option>
      </select>
      <button id="addTaskBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">Adicionar</button>
    </div>

    <!-- SEARCH & SORT -->
    <div class="flex flex-wrap gap-3">
      <input id="searchInput" type="text" placeholder="🔎 Pesquisar..." class="flex-1 px-3 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:border-gray-700 dark:text-white" />
      <select id="sortSelect" class="px-3 py-2 border rounded-md focus:ring-2 focus:ring-indigo-400 dark:bg-gray-800 dark:border-gray-700 dark:text-white">
        <option value="default">Ordenar</option>
        <option value="date">Por data</option>
        <option value="priority">Por prioridade</option>
        <option value="status">Por status</option>
      </select>
      <button id="darkToggle" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 dark:bg-gray-200 dark:text-black">🌙 Dark</button>
    </div>

    <!-- FILTERS -->
    <div class="flex flex-wrap gap-3">
      <button class="filter-btn px-4 py-2 rounded-md bg-indigo-500 text-white hover:bg-indigo-600 transition" data-filter="all">Todas</button>
      <button class="filter-btn px-4 py-2 rounded-md bg-gray-300 hover:bg-gray-400 transition dark:bg-gray-700 dark:hover:bg-gray-600" data-filter="pending">Pendentes</button>
      <button class="filter-btn px-4 py-2 rounded-md bg-gray-300 hover:bg-gray-400 transition dark:bg-gray-700 dark:hover:bg-gray-600" data-filter="completed">Concluídas</button>
    </div>

    <!-- TASK LIST -->
    <ul id="taskList" class="space-y-3"></ul>
  </div>

  <!-- TOAST -->
  <div id="toastContainer" class="fixed top-5 right-5 space-y-2 z-50"></div>

  <!-- MODAL DE CONFIRMAÇÃO -->
  <div id="modal" class="hidden fixed inset-0 flex justify-center items-center backdrop z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg max-w-sm w-full space-y-4">
      <h2 class="text-xl font-semibold text-center dark:text-white">Confirmar Exclusão</h2>
      <p class="text-center dark:text-gray-200">Tem certeza que deseja excluir esta tarefa?</p>
      <div class="flex justify-center gap-4">
        <button id="cancelDelete" class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-white">Cancelar</button>
        <button id="confirmDelete" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600">Excluir</button>
      </div>
    </div>
  </div>

<script>
/* ===========================
   VARIÁVEIS
===========================*/
const taskInput = document.getElementById('taskInput');
const taskDate = document.getElementById('taskDate');
const taskPriority = document.getElementById('taskPriority');
const addTaskBtn = document.getElementById('addTaskBtn');
const taskList = document.getElementById('taskList');
const filterBtns = document.querySelectorAll('.filter-btn');
const darkToggle = document.getElementById('darkToggle');
const searchInput = document.getElementById('searchInput');
const sortSelect = document.getElementById('sortSelect');
const toastContainer = document.getElementById('toastContainer');

const modal = document.getElementById('modal');
const confirmDeleteBtn = document.getElementById('confirmDelete');
const cancelDeleteBtn = document.getElementById('cancelDelete');

let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
let currentFilter = 'all';
let deleteIndex = null;

/* ===========================
   FUNÇÕES
===========================*/
function saveTasks() {
  localStorage.setItem('tasks', JSON.stringify(tasks));
}

function showToast(msg, type='info') {
  const toast = document.createElement('div');
  const colors = {
    info: 'bg-indigo-500',
    success: 'bg-green-500',
    danger: 'bg-red-500'
  };
  toast.className = `${colors[type]} text-white px-4 py-2 rounded-md shadow toast-show`;
  toast.textContent = msg;
  toastContainer.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

function renderTasks() {
  taskList.innerHTML = '';
  const now = new Date();
  const search = searchInput.value.toLowerCase();

  let sortedTasks = [...tasks];

  if (sortSelect.value === 'date') {
    sortedTasks.sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate));
  } else if (sortSelect.value === 'priority') {
    const order = {high:1, medium:2, low:3};
    sortedTasks.sort((a,b) => order[a.priority]-order[b.priority]);
  } else if (sortSelect.value === 'status') {
    sortedTasks.sort((a,b)=>a.completed - b.completed);
  }

  sortedTasks.forEach((task, index) => {
    if (currentFilter === 'pending' && task.completed) return;
    if (currentFilter === 'completed' && !task.completed) return;
    if (search && !task.text.toLowerCase().includes(search)) return;

    const li = document.createElement('li');
    li.className = `fade-in p-4 rounded-lg shadow flex justify-between items-center dark:bg-gray-800 ${task.completed?'opacity-60 line-through':''}`;

    const borderColor = task.priority==='high'?'border-l-4 border-red-500':
                        task.priority==='medium'?'border-l-4 border-yellow-500':
                        'border-l-4 border-green-500';
    li.classList.add(...borderColor.split(' '));

    if (task.dueDate) {
      const due = new Date(task.dueDate);
      if (due < now && !task.completed) li.classList.add('border-l-4','border-red-700');
    }

    const leftDiv = document.createElement('div');
    leftDiv.className = 'flex flex-col';
    leftDiv.innerHTML = `<span class="font-medium dark:text-white">${task.text}</span>`;
    if (task.dueDate) {
      const badge = document.createElement('span');
      badge.className = 'text-xs mt-1 px-2 py-1 rounded bg-indigo-100 text-indigo-700 dark:bg-indigo-700 dark:text-white';
      badge.textContent = 'Vence: '+task.dueDate;
      leftDiv.appendChild(badge);
    }

    const actions = document.createElement('div');
    actions.className = 'flex gap-2';
    const completeBtn = document.createElement('button');
    completeBtn.textContent = '✓';
    completeBtn.className = 'px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600';
    completeBtn.onclick = ()=>toggleComplete(index);

    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = '🗑️';
    deleteBtn.className = 'px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600';
    deleteBtn.onclick = ()=>openModal(index);

    actions.appendChild(completeBtn);
    actions.appendChild(deleteBtn);

    li.appendChild(leftDiv);
    li.appendChild(actions);
    taskList.appendChild(li);
  });
}

function addTask() {
  const text = taskInput.value.trim();
  if (!text) return showToast('Digite uma tarefa!','danger');
  tasks.push({
    text,
    dueDate: taskDate.value,
    priority: taskPriority.value,
    completed: false
  });
  saveTasks();
  renderTasks();
  showToast('Tarefa adicionada!','success');
  taskInput.value='';
  taskDate.value='';
}

function toggleComplete(index) {
  tasks[index].completed = !tasks[index].completed;
  saveTasks();
  renderTasks();
  showToast(tasks[index].completed?'Tarefa concluída!':'Tarefa marcada como pendente','info');
}

function openModal(index){
  deleteIndex = index;
  modal.classList.remove('hidden');
}

confirmDeleteBtn.onclick = ()=>{
  tasks.splice(deleteIndex,1);
  saveTasks();
  renderTasks();
  showToast('Tarefa excluída!','danger');
  modal.classList.add('hidden');
};

cancelDeleteBtn.onclick = ()=> modal.classList.add('hidden');

function setFilter(filter){
  currentFilter = filter;
  filterBtns.forEach(btn=>btn.classList.remove('bg-indigo-500','text-white'));
  document.querySelector(`.filter-btn[data-filter="${filter}"]`).classList.add('bg-indigo-500','text-white');
  renderTasks();
}

function toggleDarkMode(){
  document.documentElement.classList.toggle('dark');
}

/* ===========================
   EVENTOS
===========================*/
addTaskBtn.addEventListener('click',addTask);
filterBtns.forEach(btn=>btn.addEventListener('click',()=>setFilter(btn.dataset.filter)));
darkToggle.addEventListener('click',toggleDarkMode);
searchInput.addEventListener('input',renderTasks);
sortSelect.addEventListener('change',renderTasks);

/* ===========================
   INICIALIZAÇÃO
===========================*/
renderTasks();
</script>

</body>
</html>
