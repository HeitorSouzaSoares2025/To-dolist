<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do List</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
/* ==================== CORES BASE ==================== */
:root {
  --accent: #22c55e;
  --accent-dark: #16a34a;
  --border: #d1d5db;
  --bg-light: #ffffff;
  --text-light: #111827;
  --bg-dark: #0f172a;
  --text-dark: #e5e7eb;
  --card-bg-light: rgba(255,255,255,0.7);
  --card-bg-dark: rgba(30,41,59,0.6);
  --star: #facc15;
}
body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-light);
  color: var(--text-light);
  transition: background .3s, color .3s;
}
body.dark {
  background: var(--bg-dark);
  color: var(--text-dark);
}

/* ==================== TAREFAS ==================== */
.task-card {
  background: var(--card-bg-light);
  backdrop-filter: blur(8px);
  border: 1px solid var(--border);
  border-radius: 0.75rem;
  padding: 0.75rem;
  box-shadow: 0 4px 12px rgba(34,197,94,0.15);
  animation: fadeIn .4s ease-in;
  transition: background .3s, border .3s, transform .2s;
  position: relative;
}
body.dark .task-card {
  background: var(--card-bg-dark);
  border-color: #334155;
}
.task-card:hover { transform: translateY(-2px); }
.task-card.dragging { opacity: .5; }

/* === Barra lateral de prioridade (LIGHT) === */
.priority-low    { border-left: 6px solid #22c55e; }
.priority-medium { border-left: 6px solid #f59e0b; }
.priority-high   { border-left: 6px solid #ef4444; }

/* === Barra lateral de prioridade (DARK) === */
body.dark .priority-low    { border-left-color: #4ade80; }
body.dark .priority-medium { border-left-color: #facc15; }
body.dark .priority-high   { border-left-color: #f87171; }

/* === Importante === */
.important {
  border: 2px solid var(--star);
  box-shadow: 0 0 8px rgba(250,204,21,0.6);
}

/* ==================== FORM / INPUTS ==================== */
input, select {
  background: transparent;
  color: inherit;
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  padding: 0.5rem;
}
body.dark input, 
body.dark select {
  border-color: #475569;
  background-color: #1e293b;
  color: #e5e7eb;
}

/* Cor das opções no select */
option[value="low"]    { color: #22c55e; }
option[value="medium"] { color: #f59e0b; }
option[value="high"]   { color: #ef4444; }

/* ==================== BOTÕES ==================== */
button { transition: all .3s ease; }
.btn-accent {
  background: linear-gradient(to right, var(--accent), #06b6d4);
  color: #fff;
}
.btn-accent:hover {
  filter: brightness(1.1);
  transform: scale(1.03);
}
.star-btn {
  color: var(--star);
  font-size: 1.2rem;
  transition: transform .2s;
}
.star-btn:hover { transform: scale(1.2); }

/* ==================== ANIMAÇÃO ==================== */
@keyframes fadeIn {
  from {opacity:0; transform: translateY(10px);}
  to {opacity:1; transform: translateY(0);}
}
</style>
</head>

<body class="min-h-screen flex flex-col items-center px-2">

<!-- ==================== LOGIN ==================== -->
<div id="loginSection" class="w-full max-w-sm p-6 mt-8 rounded-xl shadow-md bg-white/70 dark:bg-slate-800/70 backdrop-blur">
  <h1 class="text-2xl mb-4 text-center font-bold">Login</h1>
  <input id="usernameInput" type="text" placeholder="Digite seu usuário"
         class="w-full p-2 mb-4 rounded border placeholder-gray-400">
  <button id="loginBtn" class="w-full btn-accent font-semibold py-2 rounded">Entrar</button>
</div>

<!-- ==================== APP ==================== -->
<div id="appSection" class="hidden w-full max-w-2xl p-4">
  <header class="flex flex-col sm:flex-row justify-between items-center gap-3 mb-4">
    <h1 class="text-3xl font-bold">To-Do List</h1>
    <div class="flex gap-2">
      <button id="toggleDarkMode" class="px-3 py-1 rounded btn-accent">Mudar Tema</button>
      <button id="logoutBtn" class="px-3 py-1 rounded bg-red-600 text-white hover:bg-red-500">Sair</button>
    </div>
  </header>

  <form id="taskForm" class="flex flex-col gap-3 mb-6 p-4 rounded-lg border backdrop-blur">
    <input id="taskInput" type="text" placeholder="Nova tarefa" class="p-2 rounded border placeholder-gray-400">
    <select id="priorityInput" class="p-2 rounded border">
      <option value="low">Baixa</option>
      <option value="medium">Média</option>
      <option value="high">Alta</option>
    </select>
    <div class="calendar">
      <input id="dueDateInput" type="date">
    </div>
    <button class="btn-accent font-semibold py-2 rounded">Adicionar</button>
  </form>

  <div class="flex flex-col sm:flex-row justify-between items-center gap-3 mb-4">
    <input id="searchInput" type="text" placeholder="Buscar tarefas"
           class="p-2 rounded border flex-1 placeholder-gray-400">
    <select id="filterSelect" class="p-2 rounded border">
      <option value="all">Todas</option>
      <option value="pending">Pendentes</option>
      <option value="completed">Concluídas</option>
    </select>
  </div>

  <ul id="taskList" class="flex flex-col gap-3"></ul>
</div>

<script>
/* ==================== VARIÁVEIS ==================== */
const loginSection=document.getElementById('loginSection')
const appSection=document.getElementById('appSection')
const usernameInput=document.getElementById('usernameInput')
const loginBtn=document.getElementById('loginBtn')
const logoutBtn=document.getElementById('logoutBtn')
const toggleDarkMode=document.getElementById('toggleDarkMode')
const taskForm=document.getElementById('taskForm')
const taskInput=document.getElementById('taskInput')
const priorityInput=document.getElementById('priorityInput')
const dueDateInput=document.getElementById('dueDateInput')
const taskList=document.getElementById('taskList')
const searchInput=document.getElementById('searchInput')
const filterSelect=document.getElementById('filterSelect')

let currentUser=null
let tasks=[]

/* ==================== FUNÇÕES PRINCIPAIS ==================== */
function saveTasks(){ localStorage.setItem(`tasks_${currentUser}`,JSON.stringify(tasks)) }
function loadTasks(){ tasks=JSON.parse(localStorage.getItem(`tasks_${currentUser}`)||'[]') }

function renderTasks(){
 taskList.innerHTML=''
 const search=searchInput.value.toLowerCase()
 const filter=filterSelect.value
 const sortedTasks=[...tasks].sort((a,b)=>b.important-a.important)

 sortedTasks.forEach((t,i)=>{
  if(t.title.toLowerCase().includes(search) && (filter==='all'||(filter==='pending'&&!t.completed)||(filter==='completed'&&t.completed))){
    const li=document.createElement('li')
    li.draggable=true
    li.dataset.index=i
    li.className=`task-card ${t.priority==='high'?'priority-high':t.priority==='medium'?'priority-medium':'priority-low'} ${t.important?'important':''}`
    li.innerHTML=`
      <div class="flex justify-between items-center">
        <div>
          <input type="checkbox" class="mr-2" ${t.completed?'checked':''}>
          <span class="${t.completed?'line-through text-gray-500':''}">${t.title}</span>
          ${t.dueDate?`<small class="ml-2 text-green-400">[${t.dueDate}]</small>`:''}
        </div>
        <div class="flex gap-2">
          <button class="toggle-important star-btn ${t.important?'':'opacity-50'}">⭐</button>
          <button class="add-subtask text-green-500">＋</button>
          <button class="delete-task text-red-500">✕</button>
        </div>
      </div>
      <ul class="subtasks mt-2 pl-6"></ul>`

    const subtasksUl=li.querySelector('.subtasks')
    t.subtasks.forEach((s)=>{
      const sLi=document.createElement('li')
      sLi.innerHTML=`<input type="checkbox" class="mr-2" ${s.done?'checked':''}>
                     <span class="${s.done?'line-through text-gray-500':''}">${s.text}</span>`
      subtasksUl.appendChild(sLi)
      sLi.querySelector('input').addEventListener('change',()=>{
        s.done=!s.done
        saveTasks();renderTasks()
      })
    })

    li.querySelector('input[type="checkbox"]').addEventListener('change',()=>{
      t.completed=!t.completed
      saveTasks();renderTasks()
    })
    li.querySelector('.delete-task').addEventListener('click',()=>{
      tasks.splice(tasks.indexOf(t),1)
      saveTasks();renderTasks()
    })
    li.querySelector('.add-subtask').addEventListener('click',()=>{
      const txt=prompt('Digite a subtarefa:')
      if(txt){t.subtasks.push({text:txt,done:false});saveTasks();renderTasks()}
    })
    li.querySelector('.toggle-important').addEventListener('click',()=>{
      t.important=!t.important
      saveTasks();renderTasks()
    })
    taskList.appendChild(li)
  }
 })
 enableDragDrop()
}

/* ==================== DRAG & DROP ==================== */
function enableDragDrop(){
 const items=document.querySelectorAll('#taskList .task-card')
 items.forEach(it=>{
  it.addEventListener('dragstart',()=>it.classList.add('dragging'))
  it.addEventListener('dragend',()=>{it.classList.remove('dragging');reorderTasks()})
 })
 taskList.addEventListener('dragover',e=>{
  e.preventDefault()
  const dragging=document.querySelector('.dragging')
  const siblings=[...taskList.querySelectorAll('.task-card:not(.dragging)')]
  const next=siblings.find(s=>e.clientY<=s.offsetTop+s.offsetHeight/2)
  taskList.insertBefore(dragging,next)
 })
}
function reorderTasks(){
 tasks=[...taskList.querySelectorAll('.task-card')].map(it=>tasks[it.dataset.index])
 saveTasks();renderTasks()
}

/* ==================== EVENTOS ==================== */
taskForm.addEventListener('submit',e=>{
 e.preventDefault()
 const title=taskInput.value.trim()
 if(title){
  tasks.push({title,completed:false,priority:priorityInput.value,dueDate:dueDateInput.value,subtasks:[],important:false})
  saveTasks();renderTasks();taskForm.reset()
 }
})
searchInput.addEventListener('input',renderTasks)
filterSelect.addEventListener('change',renderTasks)

toggleDarkMode.addEventListener('click',()=>document.body.classList.toggle('dark'))

loginBtn.addEventListener('click',()=>{
 const u=usernameInput.value.trim()
 if(u){
  currentUser=u
  loginSection.classList.add('hidden')
  appSection.classList.remove('hidden')
  loadTasks();renderTasks()
 }
})
logoutBtn.addEventListener('click',()=>{
 currentUser=null;tasks=[]
 appSection.classList.add('hidden')
 loginSection.classList.remove('hidden')
})

/* ==================== NOTIFICAÇÕES ==================== */
function checkDueDates(){
 const today=new Date().toISOString().split('T')[0]
 tasks.forEach(t=>{
  if(t.dueDate===today&&!t.completed){
   new Notification('Tarefa pendente',{body:t.title})
  }
 })
}
if('Notification'in window && Notification.permission!=='granted'){Notification.requestPermission()}
setInterval(checkDueDates,60000)
</script>

</body>
</html>
